pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

-- consts
const_screen_size = 128
const_debug       = true

-- game
playing     = false
floor_level = 10 * 6.5

-- camera stuff
cam_x = 0.0
cam_y = 0.0

-- player loc
ply_x = 50.0
ply_y = 60.0

-- ranges between 0 -> 1
-- -1.0 = full left
-- 0.0 = equilibrium
-- 1.0 = full right
tilt      = 0.0
tilt_eq   = 0.0
tilt_min  = -1.0
tilt_max  = 1.0
tilt_tick = 0.001

function update_tilt()
  -- get squared distance for change,
  -- i.e. tilt more when ur further out
  tilt_d = (abs(tilt_eq - tilt) ^ 2) / 20

  if tilt > tilt_eq then
    -- tilt right more if we are already tilting
    tilt   = min(tilt + tilt_d, tilt_max)
  elseif tilt < tilt_eq then
    -- tilt left more if we are already tilting
    tilt   = max(tilt - tilt_d, tilt_min)
  else
    -- don't change our tilt if we're in equilibrium
  end
end

-- gets perct. point of interpolate between x, y
function interpolate(x, y, perct)
  return (x - y) * perct
end

function _init()
end

function _update()
  -- input
  if (btn(0)) tilt -= 0.05
  if (btn(1)) tilt += 0.05
  if (btn(4)) playing = not playing

  -- camera
  if (playing) cam_x += 1.0

  -- physics
  if (ply_y < floor_level) ply_y += 1
  update_tilt()
end

function _draw()
  cls()

  camera(cam_x, cam_y)
  --circfill(x, y, 7, 14)

  -- draw bottom half of character
  spr(33, ply_x, ply_y, 2, 2)
  -- draw top half of character
  for i=0,16 do
    -- print(':'..(ply_x+i), 20, 50+i*8)
    tline(ply_x + i + (tilt * 16), ply_y - 16,
          ply_x + i, ply_y + 16 - 16,
          0.125 * i, 12.0,
          0.0, 0.125)
  end
  -- tline(ply_x, ply_y,
  --       ply_x, ply_y + 16,
  --       0.0, 12.0, 0.0, 0.125)
  -- tline(ply_x+2, ply_y,
  --       ply_x+2, ply_y + 16,
  --       0.125, 12.0, 0.0, 0.125)
  -- sspr(8, 0, 8, 8, ply_x, ply_y, 20, 20)

  map(0, 0, 0, 0, 100, 100)

  camera()

  -- gui section
  gui_sec_y = 95
  rectfill(0, gui_sec_y, const_screen_size, const_screen_size, 0)
  line(0, gui_sec_y, const_screen_size, gui_sec_y, 7)
  -- tiltometer gui
  gui_tilt_x = const_screen_size/2
  gui_tilt_y = 116
  gui_tilt_size = 7
  --circ(gui_tilt_x, gui_tilt_y - 15, 16)
  local p2_x = interpolate(0, gui_tilt_size, tilt)
  line(gui_tilt_x, gui_tilt_y, gui_tilt_x - p2_x, gui_tilt_y - gui_tilt_size * 2, 8)
  circ(gui_tilt_x, gui_tilt_y - gui_tilt_size, gui_tilt_size + 3, 7)
  print('tiltometer', gui_tilt_x - 18, gui_tilt_y + 7, 7)

  -- debug prints
  if debug then
    print('tilt: '..tilt, 0, 0, 7)
  end
end

__gfx__
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e1e8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eee8888888888bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb000aaaaaaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13666561136566630001003033001300000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36ddd5d636dd5d560001001030101000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
365d5d5635d5d5d60001013030011000000000098900000000000000000000000000000000000000000000000000000000000000000000000000000000000000
35d5d5d6165d5d65000311b03001300000090009a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
365d5d6636d565d600001310003b000000009098a900000000000000000000000000000000000000000000000000000000000000000000000000000000000000
16565656365656550000b010130300000009004a9a0a000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33656663136665630000b0101b033000000000a45a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
311113311311133100003033110b3000000000544500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
65313666563136560000010010003000000000454500000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d5636dd5d56365d50000010010031000000000044400000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56615d5d5d636d5d0000030b10030000000000645600000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d55165d5d56165d50000030311130000000000066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56d36d5d56636d5d00000300b1300000000000054000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
656355d5656365d500000b0033000000000000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
563136666631366600000b0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
331313333311313300000000b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4041404140414041404140414041404140410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5051505150515051505150515051505150510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000042435757000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000052535757000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000062636465640056564445000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000072737475000056565455000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000040410000000000000062636465000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000050510000000000000072737475000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000040410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000050510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4140414041404140414041404140414041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5150515051505150515051505150515051000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1112000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2122000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3132000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
